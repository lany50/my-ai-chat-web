<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AI åŠ©æ‰‹</title>
    <style>
        /* CSSå˜é‡å’ŒåŸºç¡€æ ·å¼éƒ¨åˆ†ä¿æŒä¸å˜ */
        :root {
            --bg-color: #f0f2f5; --header-bg: #ffffff; --header-border: #dddddd; --text-color: #000000; --ai-msg-bg: #e9e9eb; --user-msg-bg: #007bff; --user-msg-text: #ffffff; --input-area-bg: #ffffff; --input-border-color: #ccc; --button-bg: #007bff;
        }
        [data-theme="dark"] {
            --bg-color: #121212; --header-bg: #1e1e1e; --header-border: #333333; --text-color: #e0e0e0; --ai-msg-bg: #2a2a2a; --user-msg-bg: #0056b3; --user-msg-text: #ffffff; --input-area-bg: #1e1e1e; --input-border-color: #444; --button-bg: #0056b3;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; background-color: var(--bg-color); color: var(--text-color); transition: background-color 0.3s, color 0.3s; }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background-color: var(--header-bg); border-bottom: 1px solid var(--header-border); flex-shrink: 0; }
        .header h1 { margin: 0; font-size: 1.2em; flex-grow: 1; }
        #model-select { background-color: var(--header-bg); color: var(--text-color); border: 1px solid var(--input-border-color); border-radius: 8px; padding: 5px 8px; margin-left: auto; }
        .header-buttons { display: flex; align-items: center; gap: 10px; margin-left: 10px; }
        .header-button { background: none; border: 1px solid var(--input-border-color); border-radius: 8px; padding: 5px 8px; cursor: pointer; color: var(--text-color); }
        #chat-window { flex-grow: 1; overflow-y: auto; padding: 15px 10px; display: flex; flex-direction: column; }
        .message { max-width: 80%; padding: 8px 12px; border-radius: 18px; margin-bottom: 10px; line-height: 1.4; word-wrap: break-word; }
        .user-message { background-color: var(--user-msg-bg); color: var(--user-msg-text); align-self: flex-end; }
        .ai-message { background-color: var(--ai-msg-bg); color: var(--text-color); align-self: flex-start; }
        #input-area { display: flex; align-items: center; padding: 8px; background-color: var(--input-area-bg); border-top: 1px solid var(--header-border); flex-shrink: 0; gap: 8px; }
        #message-input { flex-grow: 1; padding: 8px 14px; border: 1px solid var(--input-border-color); border-radius: 20px; font-size: 16px; background-color: transparent; color: var(--text-color); margin: 0; }
        #send-button { padding: 8px; border: none; background-color: var(--button-bg); color: white; border-radius: 50%; cursor: pointer; font-size: 18px; width: 40px; height: 40px; flex-shrink: 0; display: flex; justify-content: center; align-items: center; }

        /* --- æ ¸å¿ƒæ”¹åŠ¨ï¼šé‡å†™å°å±å¹•çš„åª’ä½“æŸ¥è¯¢ --- */
        @media (max-width: 480px) {
            /* æ•´ä½“å‡å°å­—ä½“ï¼Œé€‚åº”å°å±å¹• */
            html {
                font-size: 15px;
            }

            /* é¡¶éƒ¨æ æè‡´å‹ç¼© */
            .header {
                padding: 6px 10px;
                gap: 8px;
            }
            .header h1 {
                display: none; /* å¿…é¡»éšè—æ ‡é¢˜ï¼Œè…¾å‡ºç©ºé—´ */
            }
            #model-select {
                padding: 4px 6px; /* èœå•å˜å¾—æ›´å° */
                font-size: 0.9em;
                margin-left: 0; /* ç§»é™¤è‡ªåŠ¨è¾¹è· */
            }
            .header-buttons {
                gap: 6px; /* æŒ‰é’®é—´è·å‡å° */
                margin-left: auto; /* è®©æŒ‰é’®ç»„æ•´ä½“é å³ */
            }
            .header-button {
                padding: 4px 8px;
            }

            /* èŠå¤©çª—å£è¾¹è·å‡å° */
            #chat-window {
                padding: 10px 8px;
            }

            /* è¾“å…¥åŒºåŸŸæè‡´å‹ç¼© */
            #input-area {
                padding: 6px 8px;
                gap: 6px;
            }
            #message-input {
                padding: 6px 12px;
                font-size: 1em; /* ç»§æ‰¿htmlçš„å­—ä½“å¤§å° */
            }
            #send-button {
                width: 36px;
                height: 36px;
                font-size: 16px; /* å›¾æ ‡å¤§å° */
            }
        }
    </style>
</head>
<body>

<!-- HTMLç»“æ„å®Œå…¨ä¸å˜ï¼Œåªä¿®æ”¹äº†å‘é€æŒ‰é’®çš„æ–‡å­—ä¸ºå›¾æ ‡ -->
<div class="header">
    <h1>AI åŠ©æ‰‹</h1>
    <select id="model-select">
        <option value="gpt-4.1">gpt-4.1</option>
        <option value="DeepSeek-R1-0528">DeepSeek-R1-0528</option>
        <option value="grok-4-0709">grok-4-0709</option>
        <option value="gemini-2.5-pro">gemini-2.5-pro</option>
    </select>
    <div class="header-buttons">
        <button id="clear-history-button" class="header-button">æ¸…ç©º</button>
        <button id="theme-toggle" class="header-button">ğŸŒ™</button>
    </div>
</div>
<div id="chat-window">
    <!-- å†å²è®°å½•ä¼šåŠ è½½åˆ°è¿™é‡Œ -->
</div>
<div id="input-area">
    <input type="text" id="message-input" placeholder="è¾“å…¥...">
    <button id="send-button">â¤</button> <!-- æŠŠ"å‘é€"æ–‡å­—æ”¹æˆä¸€ä¸ªç®­å¤´å›¾æ ‡ -->
</div>

<!-- JavaScriptéƒ¨åˆ†å®Œå…¨ä¸å˜ -->
<script>
    const chatWindow = document.getElementById('chat-window'), messageInput = document.getElementById('message-input'), sendButton = document.getElementById('send-button'), themeToggle = document.getElementById('theme-toggle'), body = document.body, modelSelect = document.getElementById('model-select'), clearHistoryButton = document.getElementById('clear-history-button');
    async function loadHistory() { try { const response = await fetch('/history'); const messages = await response.json(); chatWindow.innerHTML = ''; messages.forEach(msg => { const messageClass = msg.role === 'user' ? 'user-message' : 'ai-message'; addMessage(msg.content, messageClass, false); }); chatWindow.scrollTop = chatWindow.scrollHeight; } catch (error) { console.error('åŠ è½½å†å²è®°å½•å¤±è´¥:', error); addMessage('æ— æ³•åŠ è½½å†å²è®°å½•ã€‚', 'ai-message', false); } }
    async function clearHistory() { if (!confirm('ç¡®å®šè¦æ°¸ä¹…åˆ é™¤æ‰€æœ‰èŠå¤©è®°å½•å—ï¼Ÿ')) { return; } try { const response = await fetch('/clear', { method: 'POST' }); if (response.ok) { chatWindow.innerHTML = ''; addMessage('èŠå¤©è®°å½•å·²æ¸…ç©ºã€‚', 'ai-message'); } else { const errorData = await response.json(); addMessage(`æ¸…ç©ºå¤±è´¥: ${errorData.error}`, 'ai-message'); } } catch (error) { console.error('æ¸…ç©ºå¤±è´¥:', error); } }
    async function sendMessage() { const messageText = messageInput.value.trim(); if (messageText === '') return; addMessage(messageText, 'user-message'); messageInput.value = ''; const typingIndicator = addMessage('AIæ­£åœ¨æ€è€ƒ...', 'ai-message typing-indicator'); try { const selectedModel = modelSelect.value; const response = await fetch('/chat', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ message: messageText, model: selectedModel }), }); chatWindow.removeChild(typingIndicator); if (!response.ok) { const errorData = await response.json(); addMessage(`å‡ºé”™äº†: ${errorData.error || response.statusText}`, 'ai-message'); return; } const data = await response.json(); addMessage(data.reply, 'ai-message'); } catch (error) { if (chatWindow.contains(typingIndicator)) { chatWindow.removeChild(typingIndicator); } addMessage(`ç½‘ç»œè¯·æ±‚å¤±è´¥: ${error.message}`, 'ai-message'); } }
    function addMessage(text, classNames, doScroll = true) { const messageElement = document.createElement('div'); messageElement.classList.add('message', ...classNames.split(' ')); messageElement.textContent = text; chatWindow.appendChild(messageElement); if (doScroll) { chatWindow.scrollTop = chatWindow.scrollHeight; } return messageElement; }
    document.addEventListener('DOMContentLoaded', loadHistory);
    clearHistoryButton.addEventListener('click', clearHistory);
    sendButton.addEventListener('click', sendMessage);
    messageInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') sendMessage(); });
    const savedTheme = localStorage.getItem('theme'); if (savedTheme === 'dark') { body.setAttribute('data-theme', 'dark'); themeToggle.textContent = 'â˜€ï¸'; } else { themeToggle.textContent = 'ğŸŒ™'; }
    themeToggle.addEventListener('click', () => { if (body.getAttribute('data-theme') === 'dark') { body.removeAttribute('data-theme'); localStorage.removeItem('theme'); themeToggle.textContent = 'ğŸŒ™'; } else { body.setAttribute('data-theme', 'dark'); localStorage.setItem('theme', 'dark'); themeToggle.textContent = 'â˜€ï¸'; } });
</script>

</body>
</html>